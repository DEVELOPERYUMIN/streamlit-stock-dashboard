# pages/3_FAQ.py
import streamlit as st

st.set_page_config(page_title="FAQ", layout="wide")

st.title("FAQ (자주 묻는 질문)")

st.markdown(
"""
이 페이지는 현재 주가 조회 앱에 **실제로 구현된 기능과 내부 동작 방식**을 기준으로
자주 발생하는 질문과 그 원인을 정리한다.
"""
)

# ============================================================
# 데이터 조회 / 입력 관련
# ============================================================
st.subheader("1) 데이터 조회 / 입력")

with st.expander("날짜를 하나만 선택하면 왜 경고가 뜨나요?"):
    st.markdown(
    """
    - 이 앱은 항상 **기간 조회(시작일, 종료일)** 를 전제로 동작한다.
    - `st.date_input`은 설정에 따라 단일 날짜(date) 또는 기간(tuple)을 반환할 수 있다.
    - 코드에서는 반환값이 tuple/list이고 길이가 2인지 검사한다.
    - 날짜가 1개이거나 형식이 다르면 즉시 경고 메시지를 띄우고 조회를 중단한다.
    """
    )

with st.expander("시작일을 종료일보다 뒤로 선택했는데 오류가 안 나는 것처럼 보였어요"):
    st.markdown(
    """
    - `st.date_input`은 기본적으로 날짜를 자동 정렬하여 반환한다.
    - 따라서 UI에서 거꾸로 클릭해도 내부적으로는 `(min_date, max_date)` 형태가 된다.
    - 코드에는 추가로 `start_dt > end_dt` 가드가 있어, 이 경우 명시적으로 경고를 띄우도록 되어 있다.
    """
    )

with st.expander("종목코드를 직접 입력하면 왜 오류가 나나요?"):
    st.markdown(
    """
    - 이 앱은 회사명 검색 → 종목코드 선택 흐름을 전제로 한다.
    - 종목코드는 숫자만 허용하며, 6자리를 초과하거나 문자가 섞이면 예외를 발생시킨다.
    - 이는 Yahoo 등 다른 데이터 경로를 우회적으로 호출하는 것을 방지하기 위한 검증 로직이다.
    """
    )

with st.expander("조회했는데 '해당 기간의 주가 데이터가 없습니다'가 뜹니다"):
    st.markdown(
    """
    - 선택한 기간에 거래일이 없거나(공휴일만 포함),
      데이터 제공처에서 해당 구간 데이터를 반환하지 않은 경우 발생한다.
    - 이 경우 빈 DataFrame을 감지하여 차트 렌더링을 중단한다.
    """
    )

# ============================================================
# 차트 / 지표 표시 관련
# ============================================================
st.subheader("2) 차트 / 지표 표시")

with st.expander("MA20 / MA60을 체크했는데 선이 안 보입니다"):
    st.markdown(
    """
    - 이동평균은 계산에 필요한 최소 데이터 개수가 있다.
      - MA20: 최소 20개 데이터
      - MA60: 최소 60개 데이터
    - 선택한 기간이 짧으면 이동평균 값이 전부 NaN이 된다.
    - 코드에서는 해당 MA 컬럼이 전부 NaN일 경우 자동으로 표시 옵션을 끄고 안내 메시지를 띄운다.
    """
    )

with st.expander("거래량을 켰는데 가격 차트랑 스케일이 이상해 보입니다"):
    st.markdown(
    """
    - 가격과 거래량은 단위가 다르기 때문에 같은 y축을 사용할 수 없다.
    - 거래량은 보조축(yaxis2)을 사용하여 오른쪽 축에 표시된다.
    - 보조축을 사용하지 않으면 가격 변화가 왜곡되어 보인다.
    """
    )

with st.expander("Hover에 MA나 거래량이 안 보일 때가 있어요"):
    st.markdown(
    """
    - Hover 정보는 종가(Close) 트레이스에만 설정되어 있다.
    - 이동평균선(MA)은 hoverinfo를 skip하도록 설정되어 있다.
    - MA 값이 NaN인 구간에서는 hover에도 값이 표시되지 않는다.
    """
    )

with st.expander("글자가 잘리거나 마커 설명이 화면 밖으로 나가요"):
    st.markdown(
    """
    - Plotly는 기본적으로 차트 영역 밖 annotation이나 text를 잘라낼 수 있다.
    - 이 앱에서는 margin(top/bottom)을 넉넉하게 설정해 대부분의 잘림을 방지한다.
    - 데이터가 극단적인 위치(첫 날, 마지막 날)에 있으면 일부 텍스트가 겹칠 수 있다.
    """
    )

# ============================================================
# MDD (최대낙폭) 관련
# ============================================================
st.subheader("3) MDD (최대 낙폭)")

with st.expander("MDD는 정확히 어떻게 계산되나요?"):
    st.markdown(
    """
    - 종가 시계열 기준으로 계산한다.
    - 매 시점까지의 누적 최고가(running max)를 구한다.
    - 현재 종가 / 누적 최고가 - 1 로 드로우다운(drawdown)을 계산한다.
    - drawdown 값 중 가장 작은 값(가장 큰 음수)이 MDD다.
    """
    )

with st.expander("MDD 음영 구간은 왜 저 구간인가요?"):
    st.markdown(
    """
    - 음영 시작점(peak): MDD가 발생한 저점 이전 구간에서의 최고 종가
    - 음영 종료점(trough): 드로우다운이 최소가 되는 종가
    - 즉, '이 고점에서 샀다면 이 저점까지 떨어질 수 있었다'를 시각적으로 표현한 구간이다.
    """
    )

with st.expander("기간을 바꾸면 MDD가 달라지는 이유는 무엇인가요?"):
    st.markdown(
    """
    - MDD는 절대적인 종목 고유 값이 아니라 '조회 기간 의존 지표'다.
    - 조회 기간이 달라지면 누적 최고가와 최저점 후보가 달라진다.
    - 따라서 같은 종목이라도 기간에 따라 MDD 값과 구간이 달라진다.
    """
    )

# ============================================================
# 애니메이션 관련
# ============================================================
st.subheader("4) 애니메이션")

with st.expander("Close 타임-플레이 애니메이션은 무엇을 위한 기능인가요?"):
    st.markdown(
    """
    - 종가 라인을 시간 순서대로 점진적으로 그려주는 시각 효과다.
    - 분석 지표를 바꾸지 않으며, 추세 변화 과정을 눈으로 따라가기 쉽게 만드는 목적이다.
    """
    )

with st.expander("왜 애니메이션이 최근 약 1년만 재생되나요?"):
    st.markdown(
    """
    - Plotly frame 수가 많아지면 성능 저하 및 브라우저 렌더링 문제가 발생할 수 있다.
    - 이를 방지하기 위해 최대 260 프레임(약 1년 거래일 기준)으로 제한한다.
    """
    )

with st.expander("애니메이션을 켜면 다른 기능이 안 되는 경우가 있나요?"):
    st.markdown(
    """
    - 현재 구조에서는 Close 애니메이션만 단독으로 사용하도록 설계되어 있다.
    - MDD 애니메이션은 제거되었으며, 프레임 충돌 문제를 피하기 위한 설계 선택이다.
    """
    )

# ============================================================
# 다운로드 / 기타
# ============================================================
st.subheader("5) 다운로드 / 기타")

with st.expander("엑셀 파일에는 어떤 데이터가 들어가나요?"):
    st.markdown(
    """
    - 선택한 기간의 원본 주가 데이터(DataReader 결과)가 그대로 저장된다.
    - 차트에 표시되는 이동평균이나 계산 결과는 포함되지 않는다.
    - 엑셀은 데이터 보관 및 추가 분석 용도로 제공된다.
    """
    )

with st.expander("이 앱을 투자 판단에 바로 써도 되나요?"):
    st.markdown(
    """
    - 이 앱은 데이터 조회 및 시각화를 목적으로 한다.
    - 매수/매도 판단을 자동으로 제공하지 않으며, 투자 결과에 대한 책임을 지지 않는다.
    - 해석은 사용자 책임 하에 이루어진다.
    """
    )
