# pages/1_앱소개.py
import streamlit as st

st.set_page_config(page_title="앱 소개", layout="wide")

st.title("📘 앱 소개")

st.markdown(
"""
이 앱은 **국내(KRX) 상장 주식의 가격 흐름과 리스크를 빠르게 파악**하기 위한  
시각화 중심의 주가 조회 도구입니다.

실제 투자 사이트에서 사람들이 가장 먼저 확인하는 요소들  
(최근 흐름, 변동성, 최대 낙폭)을 한 화면에서 확인할 수 있도록 설계되었습니다.
"""
)

# ============================================================
# 1) 이 앱이 하는 일
# ============================================================
st.subheader("1️⃣ 이 앱이 하는 일")

st.markdown(
"""
- KRX 상장사 목록에서 **회사명을 검색**하고 종목을 선택한다.
- 선택한 **기간의 주가 데이터를 조회**한다.
- 다음 지표를 **선택적으로 시각화**한다.
  - 종가(Close)
  - 이동평균선(MA20 / MA60)
  - 거래량(보조축)
- **기간 요약 카드**를 제공한다.
  - 최근 종가
  - 기간 수익률
  - 최고가 / 최저가
  - 최대낙폭(MDD)
  - 일간 변동성
- **최근 흐름 요약**을 제공한다.
  - 1주 / 1개월 / 3개월 수익률
  - 상승·하락 방향을 🔺 / 🔻 아이콘으로 직관적으로 표시
- **최대낙폭(MDD)이 발생한 구간**을 차트에서 음영과 마커로 강조한다.
- 조회 결과를 **엑셀 파일로 다운로드**할 수 있다.
- 종가 라인을 **시간 순서대로 그리는 애니메이션**을 선택적으로 제공한다.
"""
)

# ============================================================
# 2) 이 앱이 하지 않는 일
# ============================================================
st.subheader("2️⃣ 이 앱이 하지 않는 일")

st.markdown(
"""
- ❌ 매수/매도 추천, 목표가 제시, 투자 판단 대행을 하지 않는다.
- ❌ 실시간(초단타) 체결 단위 데이터 제공을 하지 않는다.
  - 일자 단위 시계열 데이터 기준
- ❌ 뉴스, 공시, 재무제표 기반의 **펀더멘털 분석을 자동으로 수행하지 않는다**.
"""
)

# ============================================================
# 3) 앱 내부 동작 – 데이터 흐름 및 처리 과정
# ============================================================
st.subheader("3️⃣ 앱 내부 동작 – 데이터 흐름 및 처리 과정")

st.markdown(
"""
### ① KRX 상장사 목록 로딩 (캐시)
- KRX KIND에서 상장사 목록을 가져와 **회사명 ↔ 종목코드 데이터프레임**을 생성한다.
- `st.cache_data(ttl=1시간)`으로 캐싱하여 반복 호출 비용을 줄인다.

---

### ② 회사명 검색 → 종목 선택
- 입력한 키워드로 회사명을 **포함 검색**한다.
- `startswith` 결과를 우선 정렬하여 검색 UX를 개선한다.
- 선택된 항목에서 **회사명과 종목코드를 파싱**한다.

---

### ③ 종목코드 정규화 / 검증
- 종목코드가 **숫자만 포함하는지** 정규식으로 검사한다.
- 길이가 6자리를 초과하면 오류 처리한다.
- `zfill(6)`으로 6자리로 정규화한다.
- 👉 Yahoo 등 **다른 경로로 빠질 수 있는 입력을 사전에 차단**한다.

---

### ④ 기간 선택 가드 처리
- `st.date_input` 결과가 **2개(시작/종료)** 인지 확인한다.
- `start_dt > end_dt` 인 경우 즉시 경고 후 중단한다.

---

### ⑤ 주가 데이터 조회
- `FinanceDataReader.DataReader(stock_code, start_date, end_date)`로 데이터를 수집한다.
- 데이터가 비어 있으면 안내 후 중단한다.

---

### ⑥ 전처리 및 파생 지표 계산
- 인덱스(Date)를 `date` 컬럼으로 변환한다.
- 이동평균선(MA20 / MA60)을 계산한다.
- 선택 기간이 짧아 MA가 전부 NaN이면 해당 옵션을 자동 OFF하고 안내한다.
- 다음 요약 지표를 계산한다.
  - 기간 수익률
  - 최고 / 최저 종가
  - 최대낙폭(MDD)
  - 일간 변동성(일간 수익률 표준편차)

---

### ⑦ 요약 카드 렌더링
- `st.metric`을 사용해 핵심 지표를 카드 형태로 표시한다.
- 최근 흐름 요약(1주 / 1개월 / 3개월)은 방향 아이콘(🔺 / 🔻)으로 함께 표현한다.

---

### ⑧ Plotly 차트 생성
- `hovermode="x unified"`로 같은 날짜의 값을 한 번에 확인한다.
- range slider는 OFF로 고정한다.
- 거래량은 `yaxis2`(보조축)에 overlay하여 표시한다.

---

### ⑨ 트레이스 추가
- Close 라인(기본)을 추가한다.
- 선택 시 MA20 / MA60 라인을 추가한다.
- 선택 시 거래량 Volume을 Bar로 그리고 보조축(y2)에 표시한다.
- Hover 템플릿은 Close 트레이스 기준으로 필요한 값을 함께 표시한다.

---

### ⑩ MDD(최대낙폭) 구간 강조
- 최대낙폭이 발생한 **고점(peak) → 저점(trough)** 구간을 계산한다.
- 해당 구간을 붉은 음영으로 표시한다.
- peak / trough 마커와 라벨을 추가해 직관적인 해석을 돕는다.

---

### ⑪ Close 타임-플레이 애니메이션 (선택)
- 성능을 위해 최근 구간만 사용한다 (`MAX_FRAMES = 260`).
- frames를 구성해 종가 라인이 순차적으로 그려지도록 한다.
- Play / Pause 버튼으로 재생을 제어한다.

---

### ⑫ 결과 출력 및 다운로드
- 최근 데이터 테이블(한글 컬럼, 인덱스 제거)을 렌더링한다.
- Plotly 차트를 렌더링한다.
- 조회 데이터를 엑셀로 변환해 다운로드 버튼을 제공한다.
"""
)

st.caption("※ 본 앱은 학습 및 시각화 목적의 도구이며, 투자 판단의 책임은 사용자 본인에게 있습니다.")
